<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transport Layer | Want to be STRONG</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="need to learn">
    <link rel="preload" href="/blog/assets/css/0.styles.4dc45c00.css" as="style"><link rel="preload" href="/blog/assets/js/app.d87be1c2.js" as="script"><link rel="preload" href="/blog/assets/js/2.f8b11ca3.js" as="script"><link rel="preload" href="/blog/assets/js/5.f139aedb.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.aaf273dd.js"><link rel="prefetch" href="/blog/assets/js/11.f729ee68.js"><link rel="prefetch" href="/blog/assets/js/12.898799f5.js"><link rel="prefetch" href="/blog/assets/js/13.b1dc5878.js"><link rel="prefetch" href="/blog/assets/js/14.be0d12a4.js"><link rel="prefetch" href="/blog/assets/js/15.f265d7fa.js"><link rel="prefetch" href="/blog/assets/js/16.18d8b8b3.js"><link rel="prefetch" href="/blog/assets/js/17.245b3e61.js"><link rel="prefetch" href="/blog/assets/js/18.dac35318.js"><link rel="prefetch" href="/blog/assets/js/19.e4a4eea3.js"><link rel="prefetch" href="/blog/assets/js/20.1afede42.js"><link rel="prefetch" href="/blog/assets/js/21.22b38abd.js"><link rel="prefetch" href="/blog/assets/js/22.b3a6c7b9.js"><link rel="prefetch" href="/blog/assets/js/23.3dc579f7.js"><link rel="prefetch" href="/blog/assets/js/24.e1b41f8b.js"><link rel="prefetch" href="/blog/assets/js/25.145c0e62.js"><link rel="prefetch" href="/blog/assets/js/26.46851b62.js"><link rel="prefetch" href="/blog/assets/js/27.a31af586.js"><link rel="prefetch" href="/blog/assets/js/28.64b4da28.js"><link rel="prefetch" href="/blog/assets/js/29.783817d2.js"><link rel="prefetch" href="/blog/assets/js/3.b3ae6322.js"><link rel="prefetch" href="/blog/assets/js/30.5c60a836.js"><link rel="prefetch" href="/blog/assets/js/31.dfeb2966.js"><link rel="prefetch" href="/blog/assets/js/32.929356fb.js"><link rel="prefetch" href="/blog/assets/js/33.c649a7c6.js"><link rel="prefetch" href="/blog/assets/js/34.9e9a5a18.js"><link rel="prefetch" href="/blog/assets/js/35.41b7896f.js"><link rel="prefetch" href="/blog/assets/js/36.85a642b2.js"><link rel="prefetch" href="/blog/assets/js/37.9b0a609d.js"><link rel="prefetch" href="/blog/assets/js/38.cb190b7f.js"><link rel="prefetch" href="/blog/assets/js/39.f46bec29.js"><link rel="prefetch" href="/blog/assets/js/4.551061a2.js"><link rel="prefetch" href="/blog/assets/js/40.8323a76e.js"><link rel="prefetch" href="/blog/assets/js/41.4565eab9.js"><link rel="prefetch" href="/blog/assets/js/42.7dfd18e3.js"><link rel="prefetch" href="/blog/assets/js/43.973a6bc7.js"><link rel="prefetch" href="/blog/assets/js/44.ca045f48.js"><link rel="prefetch" href="/blog/assets/js/45.38584762.js"><link rel="prefetch" href="/blog/assets/js/46.110630d1.js"><link rel="prefetch" href="/blog/assets/js/47.8ca877df.js"><link rel="prefetch" href="/blog/assets/js/48.0af3ccd6.js"><link rel="prefetch" href="/blog/assets/js/49.9b50247f.js"><link rel="prefetch" href="/blog/assets/js/50.7422a3b9.js"><link rel="prefetch" href="/blog/assets/js/51.bbcdd05e.js"><link rel="prefetch" href="/blog/assets/js/52.9202c447.js"><link rel="prefetch" href="/blog/assets/js/53.8d9b895e.js"><link rel="prefetch" href="/blog/assets/js/6.44fae5ed.js"><link rel="prefetch" href="/blog/assets/js/7.f70e78e0.js"><link rel="prefetch" href="/blog/assets/js/8.261fd466.js"><link rel="prefetch" href="/blog/assets/js/9.3d732848.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4dc45c00.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Want to be STRONG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/RickyWei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.linkedin.com/in/ruiji-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/RickyWei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.linkedin.com/in/ruiji-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/algorithm/" class="sidebar-heading clickable"><span>Algorithm</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/cpp/" class="sidebar-heading clickable"><span>C/C++</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/network/" class="sidebar-heading clickable router-link-active open"><span>Network</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/network/applicationLayer.html" class="sidebar-link">应用层</a></li><li><a href="/blog/network/transportLayer.html" aria-current="page" class="active sidebar-link">Transport Layer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/network/transportLayer.html#udp" class="sidebar-link">UDP</a></li><li class="sidebar-sub-header"><a href="/blog/network/transportLayer.html#tcp" class="sidebar-link">TCP</a></li></ul></li><li><a href="/blog/network/networkLayer.html" class="sidebar-link">网络层</a></li><li><a href="/blog/network/linkLayer.html" class="sidebar-link">链路层</a></li><li><a href="/blog/network/physicalLayer.html" class="sidebar-link">物理层</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/os/" class="sidebar-heading clickable"><span>OS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/design/" class="sidebar-heading clickable"><span>Design</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="transport-layer"><a href="#transport-layer" class="header-anchor">#</a> Transport Layer</h1> <h2 id="udp"><a href="#udp" class="header-anchor">#</a> UDP</h2> <h3 id="udp-header"><a href="#udp-header" class="header-anchor">#</a> UDP header</h3> <p><img src="imgs/udpheader.jpg" alt="UDP header"></p> <h2 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h2> <h3 id="tcp-header"><a href="#tcp-header" class="header-anchor">#</a> TCP header</h3> <p><img src="imgs/tcpheader.jpg" alt="TCP header"></p> <h3 id="tcp-3-handshake"><a href="#tcp-3-handshake" class="header-anchor">#</a> TCP 3-handshake</h3> <p><img src="imgs/tcphandshake.jpg" alt="TCP handshake"></p> <ol><li>ISN(Initial Sequence Number) is select randomly</li> <li>3 times handshake is a kind of protect for server side.
In the case that client has sent SYN but get server's ACK and
SYN late(timeout), client thinks the server does not response
but server thinks handshake has completed and wait idlely.</li></ol> <h3 id="tcp-4-handwave"><a href="#tcp-4-handwave" class="header-anchor">#</a> TCP 4-handwave</h3> <p><img src="/blog/assets/img/tcphandwave.bc8c7ee2.jpg" alt="tcp 4 handwave"></p> <ol><li>四次挥手，因为被动关闭方将，对主动关闭的确认和关闭连接操作两次进行</li> <li>主动关闭方在返回被动关闭方FIN的ACK后，有一个2MSL(Max Segment Lifetime)的time wait
<ol><li>为了给被动方的FIN返回ACK，防止第一次返回的ACK丢失（此时server重传FIN）</li> <li>可能存在已失效的连接请求报文段，防止这种报文段出现在本次连接之外（如新连接和旧连接端口相同，这时收到旧连接的packet会认为合法），防止串话</li></ol></li></ol> <h3 id="tcp可靠性"><a href="#tcp可靠性" class="header-anchor">#</a> TCP可靠性</h3> <h4 id="time-based-重传"><a href="#time-based-重传" class="header-anchor">#</a> time based 重传</h4> <ol><li>每个TCP连接RTO(Retransmission Timeout)根据对应RTT(Round Trip Time)设置</li> <li>每个TCP设置计时器，超出TRO后重传</li> <li>Classic Method
<ol><li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="R"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="2190"></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="R"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="R"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mstyle><mjx-mspace style="width:2em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="2208"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="0"></mjx-c><mjx-c c="."></mjx-c><mjx-c c="8"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mn space="2" class="mjx-n"><mjx-c c="0"></mjx-c><mjx-c c="."></mjx-c><mjx-c c="9"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo></mjx-math></mjx-container></li> <li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="R"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="O"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="m"></mjx-c><mjx-c c="i"></mjx-c><mjx-c c="n"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="b"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mo space="2" class="mjx-n"><mjx-c c="m"></mjx-c><mjx-c c="a"></mjx-c><mjx-c c="x"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="l"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="b"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mo space="2" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="R"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="3B2"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mstyle><mjx-mspace style="width:2em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c c="3B2"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="2208"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="["></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c><mjx-c c="."></mjx-c><mjx-c c="3"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mn space="2" class="mjx-n"><mjx-c c="2"></mjx-c><mjx-c c="."></mjx-c><mjx-c c="0"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c="]"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mi space="2" class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="b"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn space="4" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mi space="2" class="mjx-i"><mjx-c c="l"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="b"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="o"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn space="4" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi></mjx-math></mjx-container></li></ol></li> <li>Standard Method
<ol><li>考虑网络波动</li> <li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="2190"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mstyle><mjx-mspace style="width:2em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mtext space="4" class="mjx-n"><mjx-c c="m"></mjx-c><mjx-c c="e"></mjx-c><mjx-c c="a"></mjx-c><mjx-c c="n"></mjx-c><mjx-c c=" "></mjx-c><mjx-c c="d"></mjx-c><mjx-c c="e"></mjx-c><mjx-c c="v"></mjx-c><mjx-c c="i"></mjx-c><mjx-c c="a"></mjx-c><mjx-c c="t"></mjx-c><mjx-c c="i"></mjx-c><mjx-c c="o"></mjx-c><mjx-c c="n"></mjx-c></mjx-mtext></mjx-math></mjx-container></li> <li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="v"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="2190"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="v"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="|"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="|"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container></li> <li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="R"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="O"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mn space="3" class="mjx-n"><mjx-c c="4"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="v"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container></li></ol></li></ol> <h4 id="快重传"><a href="#快重传" class="header-anchor">#</a> 快重传</h4> <p><img src="/blog/assets/img/fastretransimission.cf7226c4.jpg" alt="fast retransmission"></p> <ol><li>TCP reveiver在收到乱序的segment时会立即生成ACK</li> <li>TCP sender在收到重复ACK时，需确定是丢包还是延迟，当重复ACK超过duplicate ACK threshold时判断丢包，进行重传</li> <li>快重传不需等待RTO</li></ol> <h3 id="tcp流量控制"><a href="#tcp流量控制" class="header-anchor">#</a> TCP流量控制</h3> <h4 id="延迟ack"><a href="#延迟ack" class="header-anchor">#</a> 延迟ACK</h4> <ol><li>在收到packet要发送ACK时，延时等待一会，将ACK放入可能出现的要send to对端的packet中</li></ol> <h4 id="nagle算法"><a href="#nagle算法" class="header-anchor">#</a> Nagle算法</h4> <ol><li>当TCP发出的packet未收到ACK时，禁止发送small segment(<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mo class="mjx-n"><mjx-c c="&lt;"></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="z"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container>)</li> <li>相当于一个self-clocking，ACK返回的越快，可以越快send data</li> <li>nagle相当于一个trade-off，使用少量大packet（增加载荷），但相对增大了delay</li></ol> <h4 id="滑动窗口"><a href="#滑动窗口" class="header-anchor">#</a> 滑动窗口</h4> <p><img src="/blog/assets/img/swnd.1265dd38.jpg" alt="send window"> <img src="/blog/assets/img/rwnd.45339d1f.jpg" alt="send window"></p> <ol><li>TCP header的windows size filed 标识empty receive buffer space(Bytes)</li> <li>最大<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="E"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="Q"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="A"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="C"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="K"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mtext space="3" class="mjx-n"><mjx-c c="W"></mjx-c><mjx-c c="i"></mjx-c><mjx-c c="n"></mjx-c><mjx-c c="d"></mjx-c><mjx-c c="o"></mjx-c><mjx-c c="w"></mjx-c><mjx-c c=" "></mjx-c><mjx-c c="S"></mjx-c><mjx-c c="i"></mjx-c><mjx-c c="z"></mjx-c><mjx-c c="e"></mjx-c></mjx-mtext></mjx-math></mjx-container></li> <li>sender会定时发送window probes去询问reveiver是否有空余，强制recevier返回ACK和Winodw Size</li> <li>SWS(Silly Window Syndrome) 发生时，只有小的数据报被传输而非full-size，避免方法如下
<ol><li>receiver不advertise small window</li> <li>sender根据nagle算法，不发送small segment</li></ol></li></ol> <h3 id="tcp拥塞控制"><a href="#tcp拥塞控制" class="header-anchor">#</a> TCP拥塞控制</h3> <p><img src="/blog/assets/img/congestioncontrol.4e5086ea.jpg" alt="congestion control"></p> <h4 id="慢启动"><a href="#慢启动" class="header-anchor">#</a> 慢启动</h4> <ol><li>当TCP建立或丢包产生时，进行慢启动</li> <li>慢启动即在SYN交换后，cwnd(Congestion Winodow)=IW(Initial Winodw)，通常=SMSS
随后如果没有loss packet，<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="W"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn space="4" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-mo space="3" class="mjx-n"><mjx-c c="D7"></mjx-c></mjx-mo><mjx-msub space="3"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="W"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub></mjx-math></mjx-container></li> <li>delay ACK会降低增加速度，所以通常在slow start后才使用</li> <li>一般TCP发送速率为<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="W"></mjx-c></mjx-mi><mjx-TeXAtom><mjx-mo class="mjx-n"><mjx-c c="/"></mjx-c></mjx-mo></mjx-TeXAtom><mjx-mi class="mjx-i"><mjx-c c="R"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="T"></mjx-c></mjx-mi></mjx-math></mjx-container>，当W过大时，cwnd会减少到之前的一半，这个转换点为ssthresh(slow start threshold)</li></ol> <h4 id="拥塞避免（加法增大）"><a href="#拥塞避免（加法增大）" class="header-anchor">#</a> 拥塞避免（加法增大）</h4> <ol><li>当经过ssthresh后，<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="2217"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-TeXAtom><mjx-mo class="mjx-n"><mjx-c c="/"></mjx-c></mjx-mo></mjx-TeXAtom><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub></mjx-math></mjx-container>，cwnd每次只+about 1</li></ol> <h4 id="乘法减小"><a href="#乘法减小" class="header-anchor">#</a> 乘法减小</h4> <ol><li>当收到重复ACK进行快重传后，设置<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="m"></mjx-c><mjx-c c="a"></mjx-c><mjx-c c="x"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mtext class="mjx-n"><mjx-c c="f"></mjx-c><mjx-c c="l"></mjx-c><mjx-c c="i"></mjx-c><mjx-c c="g"></mjx-c><mjx-c c="h"></mjx-c><mjx-c c="t"></mjx-c><mjx-c c=" "></mjx-c><mjx-c c="s"></mjx-c><mjx-c c="i"></mjx-c><mjx-c c="z"></mjx-c><mjx-c c="e"></mjx-c></mjx-mtext><mjx-TeXAtom><mjx-mo class="mjx-n"><mjx-c c="/"></mjx-c></mjx-mo></mjx-TeXAtom><mjx-mn class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mn space="2" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-mo space="3" class="mjx-n"><mjx-c c="2217"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container></li></ol> <h4 id="快恢复"><a href="#快恢复" class="header-anchor">#</a> 快恢复</h4> <ol><li>快恢复在TCP reno版本引入，旧版theno无</li> <li>进行乘法减小后，并不从<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="w"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="d"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn space="4" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c c="M"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="S"></mjx-c></mjx-mi></mjx-math></mjx-container>开始慢启动，而是从新的ssthresh，开始加法增大</li></ol> <h3 id="tcp粘包"><a href="#tcp粘包" class="header-anchor">#</a> TCP粘包</h3> <ol><li>TCP是流协议，可能存在接收端一次读取两段或多段数据，无法区分</li> <li>原因
<ol><li>Nagle算法，TCP并不立刻发送此段数据，而是等待一小段时间，看看在等待期间是否还有要发送的数据，若有则会一次把多段数据发送出去</li> <li>接收端接收不及时造成的接收端粘包。TCP会把接收到的数据 存在自己的缓冲区中，然后通知应用层取数据。当应用层由于某些原因 不能及时取出TCP的数据，就会造成TCP缓冲区中存放了多段数据</li></ol></li> <li>解决
<ol><li>封包，给一段数据加上包头--一个固定大小的结构体，有一个成员变量表示包体长度</li></ol></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/24/2020, 2:34:12 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/network/applicationLayer.html" class="prev">
        应用层
      </a></span> <span class="next"><a href="/blog/network/networkLayer.html">
        网络层
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.d87be1c2.js" defer></script><script src="/blog/assets/js/2.f8b11ca3.js" defer></script><script src="/blog/assets/js/5.f139aedb.js" defer></script>
  </body>
</html>
