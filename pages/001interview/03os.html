<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OS | Think More</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/blog/icon.png">
    <meta name="description" content="Think More, Code Less">
    
    <link rel="preload" href="/blog/assets/css/0.styles.43b0fcec.css" as="style"><link rel="preload" href="/blog/assets/js/app.9d3bda79.js" as="script"><link rel="preload" href="/blog/assets/js/2.f5dd464a.js" as="script"><link rel="preload" href="/blog/assets/js/4.bd28a3ab.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.01784105.js"><link rel="prefetch" href="/blog/assets/js/11.28abb18e.js"><link rel="prefetch" href="/blog/assets/js/12.5192590e.js"><link rel="prefetch" href="/blog/assets/js/13.fa15fd1d.js"><link rel="prefetch" href="/blog/assets/js/14.a680706a.js"><link rel="prefetch" href="/blog/assets/js/3.008ee97d.js"><link rel="prefetch" href="/blog/assets/js/5.6ff7660d.js"><link rel="prefetch" href="/blog/assets/js/6.64947d72.js"><link rel="prefetch" href="/blog/assets/js/7.922a0cd3.js"><link rel="prefetch" href="/blog/assets/js/8.cc7450a1.js"><link rel="prefetch" href="/blog/assets/js/9.dc42911a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.43b0fcec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Think More</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/001interview/" class="nav-link router-link-active">
  Interview
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/RickyWei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.linkedin.com/in/ruiji-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/blog/pages/001interview/.html" class="nav-link">
  WeChat
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/001interview/" class="nav-link router-link-active">
  Interview
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/RickyWei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.linkedin.com/in/ruiji-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/blog/pages/001interview/.html" class="nav-link">
  WeChat
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>001interview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/pages/001interview/01algorithm.html" class="sidebar-link">Algorithm</a></li><li><a href="/blog/pages/001interview/02cpp.html" class="sidebar-link">C++</a></li><li><a href="/blog/pages/001interview/03os.html" aria-current="page" class="active sidebar-link">OS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#linux开机顺序" class="sidebar-link">linux开机顺序</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#敲击键盘时linux处理过程" class="sidebar-link">敲击键盘时linux处理过程</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#用户态和内核态" class="sidebar-link">用户态和内核态</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#堆栈" class="sidebar-link">堆栈</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#虚拟内存优点" class="sidebar-link">虚拟内存优点</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#分页与分段" class="sidebar-link">分页与分段</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#页命中与缺页" class="sidebar-link">页命中与缺页</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#地址转换" class="sidebar-link">地址转换</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#多级页表" class="sidebar-link">多级页表</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#页置换算法" class="sidebar-link">页置换算法</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#mmap" class="sidebar-link">mmap</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#进程状态" class="sidebar-link">进程状态</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#进程调度" class="sidebar-link">进程调度</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#孤儿进程与僵尸进程" class="sidebar-link">孤儿进程与僵尸进程</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#打开文件表" class="sidebar-link">打开文件表</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#fork-vfork-clone" class="sidebar-link">fork vfork clone</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#信号" class="sidebar-link">信号</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#linux进程优雅退出" class="sidebar-link">linux进程优雅退出</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#进程间通信方式" class="sidebar-link">进程间通信方式</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#进程与线程区别" class="sidebar-link">进程与线程区别</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#线程同步方式" class="sidebar-link">线程同步方式</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#互斥量的实现方式" class="sidebar-link">互斥量的实现方式</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#死锁" class="sidebar-link">死锁</a></li><li class="sidebar-sub-header"><a href="/blog/pages/001interview/03os.html#linux-命令" class="sidebar-link">Linux 命令</a></li></ul></li><li><a href="/blog/pages/001interview/04network.html" class="sidebar-link">Network</a></li><li><a href="/blog/pages/001interview/05database.html" class="sidebar-link">Database</a></li><li><a href="/blog/pages/001interview/06collection.html" class="sidebar-link">合集</a></li><li><a href="/blog/pages/001interview/" aria-current="page" class="sidebar-link">Interview questions</a></li></ul></section></li></ul> </aside> <a href="https://github.com/RickyWei" target="_blank" rel="noopener" class="github-link active"><p class="nes-balloon from-right">Follow me<br>on GitHub</p> <i class="nes-octocat"></i></a> <main class="page"> <div class="theme-default-content content__default" style="font-family:consolas;"><h1 id="os"><a href="#os" class="header-anchor">#</a> OS</h1> <h2 id="linux开机顺序"><a href="#linux开机顺序" class="header-anchor">#</a> linux开机顺序</h2> <ol><li>加电</li> <li>加载BIOS</li> <li>加载磁盘中MBR（主引导分区）的grub（GRand Unified Bootloader）引导</li> <li>加载linux内核到内存；运行/sbin/init进程</li> <li>加载配置文件/etc/inittab</li> <li>根据/etc/modules.conf /etc/modules.d/加载内核模块</li> <li>根据运行级别运行rc0.d-rc6.d中相应的脚本程序，完成对应初始化工作和启动对应服务</li> <li>启动init.d/下的系统进程</li> <li>出现登录画面</li></ol> <h2 id="敲击键盘时linux处理过程"><a href="#敲击键盘时linux处理过程" class="header-anchor">#</a> 敲击键盘时linux处理过程</h2> <ol><li>键盘控制器产生数据；并缓冲中键盘控制器寄存器中</li> <li>价盘控制器发送中断请求</li> <li>操作系统保存被中断进程的上线问；调用键盘的中断处理程序（又键盘的驱动程序初始化时注册）</li> <li>将键盘控制器缓存的数据转化为ASCII加入读缓冲队列</li> <li>显示设备驱动定时读取上述读缓冲队列加入自己的写缓冲队列；显示自己写缓冲队列中的数据</li> <li>恢复被中断的进程</li></ol> <h2 id="用户态和内核态"><a href="#用户态和内核态" class="header-anchor">#</a> 用户态和内核态</h2> <ol><li>用户态和内核态<img src="/blog/assets/img/kernelmode.ecced7f5.jpg" alt="user mode&amp;&amp;kernel mode"></li> <li>32bit
<ol><li>用户态空间占0G-3G部分，内核态占3G-4G部分（高地址）</li> <li>用户态和内核态的主要区别是权限不同，分别为（Ring3最低 Ring0最高）</li> <li>用户态到内核态的切换方式
<ol><li>系统调用</li> <li>异常</li> <li>外围设备中断</li></ol></li> <li>具体切换流程
<ol><li>内核创建进程task_struct时，会为进程创建两个栈，用户栈和内核栈</li> <li>在用户空间运行时cpu栈指针指向用户栈</li> <li>切换时先将用户态堆栈指针ss和esp压入内核堆栈</li></ol></li></ol></li> <li>64bit
<ol><li>总空间大小一般48bit</li></ol></li></ol> <h2 id="堆栈"><a href="#堆栈" class="header-anchor">#</a> 堆栈</h2> <ol><li>程序运行时内存布局<img src="/blog/assets/img/memorylayout.1494123d.jpg" alt="memory layout"></li> <li>栈帧结构<img src="/blog/assets/img/stackframe.57878636.jpg" alt="stack frame"></li></ol> <h2 id="虚拟内存优点"><a href="#虚拟内存优点" class="header-anchor">#</a> 虚拟内存优点</h2> <ol><li>虚拟内存为每个进程提供了统一的地址空间</li> <li>使各个程序独立安全，不同进程中的va对应不同pa，不同进程不可能访问到其他进程的pa</li> <li>因为进程仅被分配虚拟内存页面，这些页面的数据可以映射到物理页面，也可以临时保存到磁盘上（swap）而不占用物理页面；根据需要pageout或pagein</li></ol> <h2 id="分页与分段"><a href="#分页与分段" class="header-anchor">#</a> 分页与分段</h2> <ol><li><img src="/blog/assets/img/memoryorg.73f1c071.jpg" alt="memory organization"></li> <li>分页
<ol><li>将程序的逻辑地址空间划分为固定大小的页(page)，而物理内存划分为同样大小的页框(page frame)</li> <li>程序加载时，可将任意一页放人内存中任意一个页框，这些页框不必连续，从而实现了离散分配</li></ol></li> <li>分段
<ol><li>虚拟内存空间根据用途被分为 代码段 数据段 堆 栈</li></ol></li></ol> <h2 id="页命中与缺页"><a href="#页命中与缺页" class="header-anchor">#</a> 页命中与缺页</h2> <ol><li>page hit &amp; page fault <img src="/blog/assets/img/page2.5b7f8581.jpg" alt="page hit &amp; fault"></li> <li>page hit &amp; page fault <img src="/blog/assets/img/page.37f112b7.jpg" alt="page hit &amp; fault"></li> <li>页表存储在内存中</li> <li>MMU中存在TLB（translation lookaside buffer）用来缓存PTE，加速查找</li></ol> <h2 id="地址转换"><a href="#地址转换" class="header-anchor">#</a> 地址转换</h2> <ol><li>address translation <img src="/blog/assets/img/translation.74a6c3eb.jpg" alt="address translation"></li></ol> <h2 id="多级页表"><a href="#多级页表" class="header-anchor">#</a> 多级页表</h2> <ol><li>多级页表结构 <img src="/blog/assets/img/level.bf386222.jpg" alt="multi level page table"></li> <li>多级页表减少了页表在内存中的大小</li></ol> <h2 id="页置换算法"><a href="#页置换算法" class="header-anchor">#</a> 页置换算法</h2> <ol><li>FIFO 淘汰最早进入内存的页面</li> <li>LRU 淘汰最近没有使用的页面</li> <li>LFU 淘汰最不常访问（计数最小）的页面</li> <li>OPT 淘汰以后不会使用的页面</li></ol> <h2 id="mmap"><a href="#mmap" class="header-anchor">#</a> mmap</h2> <ol><li><code>void *mmap(void *addr, size_t len, int prot, int flag, int fd, off_t off );</code> <img src="/blog/assets/img/mmap.49700967.jpg" alt="mmap"></li> <li>实现
<ol><li>在当前进程的虚拟空间中，寻找一段空闲的满足要求的连续虚拟地址</li> <li>为次虚拟分区分配一个vm_area_struct结构</li> <li>将vm_area_struct插入进程的虚拟地址分区链表中</li></ol></li> <li>有点
<ol><li>普通read() write()会先将数据保存在内核buffer中，导致两次数据拷贝；mmap()直接拷贝到用户空间</li> <li>mmap()使得用户空间和内核空间可以交互</li> <li>mmap()同时也是进程间通信的方式</li></ol></li> <li>落盘时机
<ol><li>一定时间延迟后</li> <li>调用msync()或munmap()</li> <li>内存不足</li> <li>进程退出</li></ol></li></ol> <h2 id="进程状态"><a href="#进程状态" class="header-anchor">#</a> 进程状态</h2> <ol><li>进程状态 <img src="/blog/assets/img/processstate.042ea2af.png" alt="process state"></li></ol> <h2 id="进程调度"><a href="#进程调度" class="header-anchor">#</a> 进程调度</h2> <ol><li>FCFS 先来先服务</li> <li>SJF 短作业优先
<ol><li>长作业可能饥饿</li></ol></li> <li>基于优先权
<ol><li>非抢占式</li> <li>抢占式</li> <li>低优先级可能饥饿</li></ol></li> <li>响应比优先
<ol><li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="R"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow size="s"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">等</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">待</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">时</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">间</mjx-utext></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">要</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">求</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">夫</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">妇</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">时</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">间</mjx-utext></mjx-mo></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mrow size="s"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">要</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">求</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">服</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">务</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">时</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">间</mjx-utext></mjx-mo></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container></li></ol></li> <li>时间片轮转</li> <li>多级反馈队列
<ol><li>按优先级划分多个就绪队列，每个队列的时间片大小随优先级增大而减小</li> <li>仅当i-1队列为空时，队列i的任务被执行</li> <li>新线程进入时加入优先级最高的队列，执行完时间片后移入下一个队列</li> <li>在若干cpu时间后将低优先级队列的进程放入高优先级队列防止饥饿</li></ol></li> <li>CFS 完全公平算法
<ol><li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">分</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">配</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">给</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">进</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">程</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">的</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">运</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">行</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">时</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">间</mjx-utext><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow size="s"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">调</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">度</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">周</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">期</mjx-utext></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="2217"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">进</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">程</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">权</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">重</mjx-utext></mjx-mo></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mrow size="s"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">所</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">有</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">进</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">程</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">权</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">重</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">和</mjx-utext></mjx-mo></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container> 其中调度周期是遍历所有task_running状态的进程的时间和</li> <li><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="v"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow size="s"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">实</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">际</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">运</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">行</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">时</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">间</mjx-utext></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="2217"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c><mjx-c c="0"></mjx-c><mjx-c c="2"></mjx-c><mjx-c c="4"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mrow size="s"><mjx-mo class="mjx-n"><mjx-utext variant="normal" style="font-family:serif;">进</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">程</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">权</mjx-utext><mjx-utext variant="normal" style="font-family:serif;">重</mjx-utext></mjx-mo></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container></li> <li>根据vruntime的大小决定运行顺序（小的优先），红黑树记录vruntime-min_vruntime防止值溢出</li> <li>权重通过nice值转换，nice越大权重越低</li> <li>新进程的vruntime的红黑树中记录的min_vruntime，防止旧进程饥饿</li> <li>休眠进程被唤醒时，vruntime以min_vruntime为基础，并进行少量补偿</li> <li>进程在cpu间切换时，首先减去当前cpu的min_vruntime转移后加上目标cpu的min_vruntime</li></ol></li></ol> <h2 id="孤儿进程与僵尸进程"><a href="#孤儿进程与僵尸进程" class="header-anchor">#</a> 孤儿进程与僵尸进程</h2> <ol><li>孤儿进程
<ol><li>父进程退出的进程</li> <li>孤儿进程会被init进程收养</li></ol></li> <li>僵尸进程
<ol><li>子进程退出但父进程未调用wait()或waitpid()，那么子进程仍然保留在系统中，成为僵尸进程defunct</li> <li>僵尸进程会占用占用资源</li> <li>解决
<ol><li>父进程代码中调用wait()或waitpid()</li> <li>子进程退出时向父进程发送SIGCHILD信号，父进程处理SIGCHILD信号。在信号处理函数中调用wait进行处理僵尸进程</li> <li>fork()两次，子进程创建孙子进程，子进程直接退出，孙子进程执行操作，此时孙子进程成为孤儿交由init管理</li> <li>kill，kill不掉时kill僵尸进程的父进程</li> <li>重启</li></ol></li></ol></li></ol> <h2 id="打开文件表"><a href="#打开文件表" class="header-anchor">#</a> 打开文件表</h2> <ol><li>每个进程都有一个打开文件表<img src="/blog/assets/img/filetable.9a98b9be.png" alt="file table"></li></ol> <h2 id="fork-vfork-clone"><a href="#fork-vfork-clone" class="header-anchor">#</a> fork vfork clone</h2> <ol><li>fork() 的子进程是父进程的完全副本
<ol><li>相同
<ol><li>Real user ID, real group ID, effective user ID, and effective group ID</li> <li>Supplementary group IDs</li> <li>Process group ID</li> <li>Session ID</li> <li>Controlling terminal</li> <li>The set-user-ID and set-group-ID flags</li> <li>Current working directory</li> <li>Root directory</li> <li>File mode creation mask</li> <li>Signal mask and dispositions</li> <li>The close-on-exec flag for any open file descriptors</li> <li>Environment</li> <li>Attached shared memory segments</li> <li>Memory mappings</li> <li>Resource limits</li></ol></li> <li>不同
<ol><li>The return values from fork are different.</li> <li>The process IDs are different.</li> <li>The two processes have different parent process IDs: the parent process ID of the child is the parent; the  parent process ID of the parent doesn’t change.</li> <li>The child’s tms_utime, tms_stime, tms_cutime, and tms_cstime values are set to 0</li> <li>File locks set by the parent are not inherited by the child.</li> <li>Pending alarms are cleared for the child.</li> <li>The set of pending signals for the child is set to the empty set</li></ol></li> <li>fork使用cow写时复制技术，开始时子进程共享父进程空间（页帧），仅当子进程修改数据时复制</li></ol></li> <li>vfork()
<ol><li>vfork保证子进程先运行，父进程被挂起，适用于子进程立即调用exec()的情形</li> <li>vfork直接共享父进程空间</li> <li>vfork的子进程退出时应使用exit() 而非return</li></ol></li> <li>clone()
<ol><li>clone函数有更多的参数控制如何复制进程，linux的pthread使用clone创建</li></ol></li></ol> <h2 id="信号"><a href="#信号" class="header-anchor">#</a> 信号</h2> <ol><li>常见信号 <img src="/blog/assets/img/signal.fca25e29.jpg" alt="signal"></li> <li>常见信号产生
<ol><li>ctrl+c SIGINT</li> <li>子进程结束 SIGCHILD</li> <li>terminal关闭 SIGHUB</li></ol></li></ol> <h2 id="linux进程优雅退出"><a href="#linux进程优雅退出" class="header-anchor">#</a> linux进程优雅退出</h2> <ol><li>设置信号处理函数，在进程结束时清理资源</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sig <span class="token operator">==</span> SIGINT<span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;SIGINT\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sig <span class="token operator">==</span> SIGKILL<span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;SIGKILL\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sig <span class="token operator">==</span> SIGSEGV<span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;SIGSEGV\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sig <span class="token operator">==</span> SIGTERM<span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;SIGTERM\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;clear resource...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;graceful exit \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="进程间通信方式"><a href="#进程间通信方式" class="header-anchor">#</a> 进程间通信方式</h2> <ol><li>无名管道 pipe</li> <li>有名管道 fifo</li> <li>信号 signal</li> <li>消息队列</li> <li>共享内存</li> <li>信号量 semaphore</li> <li>套接字 socket</li></ol> <h2 id="进程与线程区别"><a href="#进程与线程区别" class="header-anchor">#</a> 进程与线程区别</h2> <ol><li>linux下线程是通过进程实现的（线程是轻量级进程）</li> <li>同一个进程下的线程共享该进程空间，每增加一个线程内存使用仅多一个栈的大小</li></ol> <h2 id="线程同步方式"><a href="#线程同步方式" class="header-anchor">#</a> 线程同步方式</h2> <ol><li>互斥量</li> <li>条件变量</li> <li>信号量</li></ol> <h2 id="互斥量的实现方式"><a href="#互斥量的实现方式" class="header-anchor">#</a> 互斥量的实现方式</h2> <ol><li>操作系统testandset()
<ol><li>保证对互斥量的检查和赋值是原子的</li></ol></li></ol> <h2 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h2> <ol><li>死锁条件
<ol><li>互斥条件：一个资源每次只能被一个进程使用</li> <li>占有且等待：一个进程因请求资源而阻塞时，对已获得的资源保持不放</li> <li>不可强行占有:进程已获得的资源，在末使用完之前，不能强行剥夺</li> <li>循环等待条件:若干进程之间形成一种头尾相接的循环等待资源关系</li></ol></li> <li>处理死锁
<ol><li>死锁预防：通过设置某些限制条件，去破坏死锁的四个条件中的一个或几个条件，来预防发生死锁</li> <li>死锁避免：允许前三个必要条件，但通过明智的选择，确保永远不会到达死锁点</li> <li>死锁检测：不须实现采取任何限制性措施，而是允许系统在运行过程发生死锁，但可通过系统设置的检测机构及时检测出死锁的发生，并精确地确定于死锁相关的进程和资源，然后采取适当的措施，从系统中将已发生的死锁清除掉</li> <li>死锁解除：撤销或挂起一些进程，以便回收一些资源，再将这些资源分配给已处于阻塞状态的进程</li></ol></li></ol> <h2 id="linux-命令"><a href="#linux-命令" class="header-anchor">#</a> Linux 命令</h2> <ol><li>如何将进程放置后台和前台
<ol><li><code>./server &amp;</code></li> <li><code>bg jobid</code> jobid通过jobs获取</li> <li><code>fg jobid</code></li></ol></li> <li>命令行中的信号
<ol><li>ctrl+c SIGINT 结束进程</li> <li>ctrl+z SIGTSTP 将一个正在前台执行的命令放到后台，并且处于暂停状态，不可执行</li></ol></li> <li>ssh断开后后台进程
<ol><li>在ssh中启动的后台进程会挂</li> <li><code>nohub ./server &amp;</code> 在用户注销或者网络断开时终端会受到HUP信号而关闭所有子进程，nohub让终端忽略</li></ol></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/5/2020, 3:24:00 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      &lt;
      <a href="/blog/pages/001interview/02cpp.html" class="prev">
        C++
      </a></span> <span class="next"><a href="/blog/pages/001interview/04network.html">
        Network
      </a>
      &gt;
    </span></p></div> </main> <button type="button" class="nes-btn is-success scroll-btn"><span>&lt;</span></button></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.9d3bda79.js" defer></script><script src="/blog/assets/js/2.f5dd464a.js" defer></script><script src="/blog/assets/js/4.bd28a3ab.js" defer></script>
  </body>
</html>
