(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{414:function(t,s,a){t.exports=a.p+"assets/img/rpc.a9220d34.png"},477:function(t,s,a){"use strict";a.r(s);var n=a(20),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"design"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#design"}},[t._v("#")]),t._v(" Design")]),t._v(" "),n("h2",{attrs:{id:"设计原则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计原则"}},[t._v("#")]),t._v(" 设计原则")]),t._v(" "),n("ol",[n("li",[t._v("单一职责原则(Single Responsibility Principle)；就一个类而言， 应该仅有一个引起它变化的原因")]),t._v(" "),n("li",[t._v("开放封闭原则（Open Close Principle）；类、模块、函数等应该是可以拓展的，但是不可修改")]),t._v(" "),n("li",[t._v("里氏替换原则（Liskov Substitution Principle）；所有引用基类的地方必须能透明地使用其子类的对象")]),t._v(" "),n("li",[t._v("依赖倒置原则（Dependence Inversion Principle）；高层模块不应该依赖于低层模块，两者都应该依赖于抽象。抽象不应该依赖于细节，细节应该依赖于抽象")]),t._v(" "),n("li",[t._v("接口隔离原则（InterfaceSegregation Principles）；一个类对另一个类的依赖应该建立在最小的接口上")]),t._v(" "),n("li",[t._v("迪米特原则（Law of Demeter）；一个软件实体应当尽可能少地与其他实体发生相互作用")])]),t._v(" "),n("h2",{attrs:{id:"单例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单例"}},[t._v("#")]),t._v(" 单例")]),t._v(" "),n("ol",[n("li",[t._v("保证一个类只能产生一个实例")]),t._v(" "),n("li",[t._v("构造函数，拷贝构造，赋值构造函数，析构函数为private类型")]),t._v(" "),n("li",[t._v("类里有个获取实例的静态函数，可以全局访问")])]),t._v(" "),n("div",{staticClass:"language-cpp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 饿汉默认线程安全")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 懒汉加锁解决")]),t._v("\nSingleInstance "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SingleInstance")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetInstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// double check")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// avoid to get mutex frequently")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_SingleInstance "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("unique_lock"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("mutex"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_Mutex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_SingleInstance "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      m_SingleInstance "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("nothrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" SingleInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" m_SingleInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// c++11 局部静态变量只初始化一次")]),t._v("\nSingle "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Single")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetInstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 局部静态特性的方式实现单实例")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" Single s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br")])]),n("h2",{attrs:{id:"设计扫码登录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计扫码登录"}},[t._v("#")]),t._v(" 设计扫码登录")]),t._v(" "),n("ol",[n("li",[t._v("浏览器打开网页，向服务器请求二维码")]),t._v(" "),n("li",[t._v("服务器收到请求后生成uuid并存入redis并设置超时时间；过期后需要刷新二维码")]),t._v(" "),n("li",[t._v("浏览器轮询或长连接（服务器轮询）")]),t._v(" "),n("li",[t._v("手机扫码，因为手机端已登录，扫码请求时携带登录信息")]),t._v(" "),n("li",[t._v("服务器解析出登录信息，绑定uuid和用户信息，返回确认信息给手机端")]),t._v(" "),n("li",[t._v("手机端用户确认")]),t._v(" "),n("li",[t._v("浏览器轮询查到状态为扫描成功，登录成功，并将uuid和用户信息保存")])]),t._v(" "),n("h2",{attrs:{id:"红包金额算法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#红包金额算法"}},[t._v("#")]),t._v(" 红包金额算法")]),t._v(" "),n("ol",[n("li",[t._v("二倍均值法\n"),n("ol",[n("li",[t._v("假设剩余红包金额 m，剩余人数n，"),n("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[n("mjx-math",{staticClass:" MJX-TEX"},[n("mjx-mo",{staticClass:"mjx-n"},[n("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("每")]),n("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("轮")]),n("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("金")]),n("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("额")]),n("mjx-c",{attrs:{c:"="}}),n("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("随")]),n("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("机")]),n("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("区")]),n("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("间")])],1),n("mjx-mo",{staticClass:"mjx-n",attrs:{space:"4"}},[n("mjx-c",{attrs:{c:"["}})],1),n("mjx-mn",{staticClass:"mjx-n"},[n("mjx-c",{attrs:{c:"0"}}),n("mjx-c",{attrs:{c:"."}}),n("mjx-c",{attrs:{c:"0"}}),n("mjx-c",{attrs:{c:"1"}})],1),n("mjx-mo",{staticClass:"mjx-n"},[n("mjx-c",{attrs:{c:","}})],1),n("mjx-mfrac",{attrs:{space:"2"}},[n("mjx-frac",[n("mjx-num",[n("mjx-nstrut"),n("mjx-mrow",{attrs:{size:"s"}},[n("mjx-mi",{staticClass:"mjx-i"},[n("mjx-c",{attrs:{c:"m"}})],1),n("mjx-mo",{staticClass:"mjx-n"},[n("mjx-c",{attrs:{c:"2217"}})],1),n("mjx-mn",{staticClass:"mjx-n"},[n("mjx-c",{attrs:{c:"2"}})],1)],1)],1),n("mjx-dbox",[n("mjx-dtable",[n("mjx-line"),n("mjx-row",[n("mjx-den",[n("mjx-dstrut"),n("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[n("mjx-c",{attrs:{c:"n"}})],1)],1)],1)],1)],1)],1)],1),n("mjx-mo",{staticClass:"mjx-n",attrs:{space:"3"}},[n("mjx-c",{attrs:{c:"2212"}})],1),n("mjx-mn",{staticClass:"mjx-n",attrs:{space:"3"}},[n("mjx-c",{attrs:{c:"0"}}),n("mjx-c",{attrs:{c:"."}}),n("mjx-c",{attrs:{c:"0"}}),n("mjx-c",{attrs:{c:"1"}})],1),n("mjx-mo",{staticClass:"mjx-n"},[n("mjx-c",{attrs:{c:"]"}})],1)],1)],1)],1),t._v(" "),n("li",[t._v("除了最后一次，任何人金额不会超过人均的两倍（100元10人，不会超过20）")]),t._v(" "),n("li",[t._v("当前面人手气好时，注意保证后面人最少0.01")])])]),t._v(" "),n("li",[t._v("线段分割法\n"),n("ol",[n("li",[t._v("总共 n 人抢红包，直接选 n-1 个点将红包分为 n 份")])])])]),t._v(" "),n("h2",{attrs:{id:"抢红包系统"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#抢红包系统"}},[t._v("#")]),t._v(" 抢红包系统")]),t._v(" "),n("ol",[n("li",[t._v("系统为每个红包生成唯一id")]),t._v(" "),n("li",[t._v("根据红包id进行hash使得不同红包的所有处理分布在不同的server上，server进行逻辑处理并配备数据库")]),t._v(" "),n("li",[t._v("抢红包只查询数据缓存，不落在数据库")]),t._v(" "),n("li",[t._v("对于过期红包，已完成红包，已领取用户做拦截处理")]),t._v(" "),n("li",[t._v("超过两天后的红包访问量下降，热数据库只存放近几天的数据，其他放入冷数据库")]),t._v(" "),n("li",[t._v("故障处理\n"),n("ol",[n("li",[t._v("下单缓存故障，红包在数据库生成")]),t._v(" "),n("li",[t._v("抢红包缓存故障，降级为数据库查询，同时数据库限流")]),t._v(" "),n("li",[t._v("资金入库多层降级，拆红包后单据实时落地，资金转账多层处理")])])])]),t._v(" "),n("h2",{attrs:{id:"秒杀系统"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#秒杀系统"}},[t._v("#")]),t._v(" 秒杀系统")]),t._v(" "),n("ol",[n("li",[t._v("业务特点\n"),n("ol",[n("li",[t._v("瞬时流量大")]),t._v(" "),n("li",[t._v("参与用户多，商品数量少")]),t._v(" "),n("li",[t._v("请求读多写少")]),t._v(" "),n("li",[t._v("秒杀状态转换实时性高")])])]),t._v(" "),n("li",[t._v("前端\n"),n("ol",[n("li",[t._v("页面静态化，通过CDN分流")]),t._v(" "),n("li",[t._v("禁止重复提交，用户提交后按钮置灰")]),t._v(" "),n("li",[t._v("用户限流，同一用户某段时间内只能提交一次请求，如通过IP限流")])])]),t._v(" "),n("li",[t._v("后端\n"),n("ol",[n("li",[t._v("业务分离，秒杀业务和其他业务隔离")]),t._v(" "),n("li",[t._v("消息队列缓存请求，服务器根据自身处理能力从队列中获取任务，数据库订阅消息减库存，成功返回秒杀成功，失败返回秒杀结束")]),t._v(" "),n("li",[t._v("可将读写请求分离，redis缓存执行写操作")]),t._v(" "),n("li",[t._v("压力测试")])])])]),t._v(" "),n("h2",{attrs:{id:"网页检测和优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网页检测和优化"}},[t._v("#")]),t._v(" 网页检测和优化")]),t._v(" "),n("ol",[n("li",[t._v("自己测试是否有相同的问题")]),t._v(" "),n("li",[t._v("如果自己也有问题，打开调试功能查看加载最慢的请求")]),t._v(" "),n("li",[t._v("查看服务器负载，如果负载都不高，查看nginx等是否有错误日志")]),t._v(" "),n("li",[t._v("查看mysql的慢查询日志，看是否有查询太慢")])]),t._v(" "),n("h2",{attrs:{id:"redis日活-连续登录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis日活-连续登录"}},[t._v("#")]),t._v(" redis日活，连续登录")]),t._v(" "),n("ol",[n("li",[t._v("bitmap每个offset对应一个userid，key为日期（2020:12:27），value为如果该用户登陆过对应offset为1")]),t._v(" "),n("li",[t._v("日活，周活，月活可以所有天数间取or，连续登录可以两天间的值取and")]),t._v(" "),n("li",[n("code",[t._v("setbit key offset value")]),t._v(" -> "),n("code",[t._v("setbit onlineuser id 1")]),t._v("; "),n("code",[t._v("getbit key offset")]),t._v(" "),n("code",[t._v("bitcount key start end")])])]),t._v(" "),n("h2",{attrs:{id:"redis推荐去重"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis推荐去重"}},[t._v("#")]),t._v(" redis推荐去重")]),t._v(" "),n("ol",[n("li",[t._v("使用bitmap")])]),t._v(" "),n("h2",{attrs:{id:"rpc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rpc"}},[t._v("#")]),t._v(" rpc")]),t._v(" "),n("p",[n("img",{attrs:{src:a(414),alt:"rpc"}})]),t._v(" "),n("ol",[n("li",[t._v("主要组成\n"),n("ol",[n("li",[t._v("服务端：服务接口，服务实现，服务暴露（把自己ip注册到注册中心，可以被客户端发现）")]),t._v(" "),n("li",[t._v("客户端：服务接口，服务引用")])])]),t._v(" "),n("li",[t._v("流程\n"),n("ol",[n("li",[t._v("服务消费方（client）以本地调用方式调用服务；")]),t._v(" "),n("li",[t._v("client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体；")]),t._v(" "),n("li",[t._v("client stub找到服务地址，并将消息发送到服务端；")]),t._v(" "),n("li",[t._v("server stub收到消息后进行解码；")]),t._v(" "),n("li",[t._v("server stub根据解码结果 反射调用 本地的服务；")]),t._v(" "),n("li",[t._v("本地服务执行并将结果返回给server stub；")]),t._v(" "),n("li",[t._v("server stub将返回结果打包成消息并发送至消费方；")]),t._v(" "),n("li",[t._v("client stub接收到消息，并进行解码；")]),t._v(" "),n("li",[t._v("服务消费方得到最终结果")])])])]),t._v(" "),n("h2",{attrs:{id:"mq"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mq"}},[t._v("#")]),t._v(" mq")]),t._v(" "),n("ol",[n("li",[t._v("应用场景\n"),n("ol",[n("li",[t._v("异步处理：处理如短信下发、状态推送、用户注册、数据同步等功能，提高系统的并发能力，集中力量处理重要的部分（同步处理），将非核心功能丢给MQ")]),t._v(" "),n("li",[t._v("系统解耦：可在模块、服务、接口等不同粒度上实现解耦")]),t._v(" "),n("li",[t._v("重试补偿：在跨机器数据传输的整个过程中，只要任意一个环节出错，都会导致问题的产生。可以通过MQ的重试补偿机制去尽可能的处理掉这些异常")]),t._v(" "),n("li",[t._v("流量削锋：对于秒杀场景下的下单处理。服务器收到消息后，首先写入消息队列，然后按照自己的消息处理能力做处理")]),t._v(" "),n("li",[t._v("日志处理：可以定时将日志写入MQ，并且主动订阅日志记录")])])]),t._v(" "),n("li",[t._v("组件\n"),n("ol",[n("li",[t._v("消息服务器Broker：消息服务器，作为server提供消息核心服务")]),t._v(" "),n("li",[t._v("消息生产者Producer：发送消息到消息队列")]),t._v(" "),n("li",[t._v("消息消费者Consumer：从消息队列接收消息")]),t._v(" "),n("li",[t._v("消息队列Queue：一个先进先出的消息存储区域。消息按照顺序发送接收，一旦消息被消费处理，该消息将从队列中删除")])])]),t._v(" "),n("li",[t._v("消息模式\n"),n("ol",[n("li",[t._v("点对点，FIFO每个消息只能被某一个消费者消费一次")]),t._v(" "),n("li",[t._v("订阅和发布")])])])]),t._v(" "),n("h2",{attrs:{id:"fastdfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fastdfs"}},[t._v("#")]),t._v(" fastdfs")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://www.ityouknow.com/fastdfs/2018/01/06/distributed-file-system-fastdfs.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("fastdfs"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);