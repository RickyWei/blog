(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{422:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"design"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#design"}},[t._v("#")]),t._v(" Design")]),t._v(" "),a("h2",{attrs:{id:"设计原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设计原则"}},[t._v("#")]),t._v(" 设计原则")]),t._v(" "),a("ol",[a("li",[t._v("单一职责原则(Single Responsibility Principle)；就一个类而言， 应该仅有一个引起它变化的原因")]),t._v(" "),a("li",[t._v("开放封闭原则（Open Close Principle）；类、模块、函数等应该是可以拓展的，但是不可修改")]),t._v(" "),a("li",[t._v("里氏替换原则（Liskov Substitution Principle）；所有引用基类的地方必须能透明地使用其子类的对象")]),t._v(" "),a("li",[t._v("依赖倒置原则（Dependence Inversion Principle）；高层模块不应该依赖于低层模块，两者都应该依赖于抽象。抽象不应该依赖于细节，细节应该依赖于抽象")]),t._v(" "),a("li",[t._v("接口隔离原则（InterfaceSegregation Principles）；一个类对另一个类的依赖应该建立在最小的接口上")]),t._v(" "),a("li",[t._v("迪米特原则（Law of Demeter）；一个软件实体应当尽可能少地与其他实体发生相互作用")])]),t._v(" "),a("h2",{attrs:{id:"单例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单例"}},[t._v("#")]),t._v(" 单例")]),t._v(" "),a("ol",[a("li",[t._v("保证一个类只能产生一个实例")]),t._v(" "),a("li",[t._v("构造函数，拷贝构造，赋值构造函数，析构函数为private类型")]),t._v(" "),a("li",[t._v("类里有个获取实例的静态函数，可以全局访问")])]),t._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 饿汉默认线程安全")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 懒汉加锁解决")]),t._v("\nSingleInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SingleInstance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// double check")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// avoid to get mutex frequently")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_SingleInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("unique_lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("std"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("mutex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_Mutex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_SingleInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      m_SingleInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("nothrow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" SingleInstance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" m_SingleInstance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// c++11 局部静态变量只初始化一次")]),t._v("\nSingle "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Single")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 局部静态特性的方式实现单实例")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" Single s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("h2",{attrs:{id:"设计扫码登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设计扫码登录"}},[t._v("#")]),t._v(" 设计扫码登录")]),t._v(" "),a("ol",[a("li",[t._v("浏览器打开网页，向服务器请求二维码")]),t._v(" "),a("li",[t._v("服务器收到请求后生成uuid并存入redis并设置超时时间；过期后需要刷新二维码")]),t._v(" "),a("li",[t._v("浏览器轮询或长连接（服务器轮询）")]),t._v(" "),a("li",[t._v("手机扫码，因为手机端已登录，扫码请求时携带登录信息")]),t._v(" "),a("li",[t._v("服务器解析出登录信息，绑定uuid和用户信息，返回确认信息给手机端")]),t._v(" "),a("li",[t._v("手机端用户确认")]),t._v(" "),a("li",[t._v("浏览器轮询查到状态为扫描成功，登录成功，并将uuid和用户信息保存")])]),t._v(" "),a("h2",{attrs:{id:"红包金额算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#红包金额算法"}},[t._v("#")]),t._v(" 红包金额算法")]),t._v(" "),a("ol",[a("li",[t._v("二倍均值法\n"),a("ol",[a("li",[t._v("假设剩余红包金额 m，剩余人数n，"),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[a("mjx-math",{staticClass:" MJX-TEX"},[a("mjx-mo",{staticClass:"mjx-n"},[a("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("每")]),a("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("轮")]),a("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("金")]),a("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("额")]),a("mjx-c",{attrs:{c:"="}}),a("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("随")]),a("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("机")]),a("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("区")]),a("mjx-utext",{staticStyle:{"font-family":"serif"},attrs:{variant:"normal"}},[t._v("间")])],1),a("mjx-mo",{staticClass:"mjx-n",attrs:{space:"4"}},[a("mjx-c",{attrs:{c:"["}})],1),a("mjx-mn",{staticClass:"mjx-n"},[a("mjx-c",{attrs:{c:"0"}}),a("mjx-c",{attrs:{c:"."}}),a("mjx-c",{attrs:{c:"0"}}),a("mjx-c",{attrs:{c:"1"}})],1),a("mjx-mo",{staticClass:"mjx-n"},[a("mjx-c",{attrs:{c:","}})],1),a("mjx-mfrac",{attrs:{space:"2"}},[a("mjx-frac",[a("mjx-num",[a("mjx-nstrut"),a("mjx-mrow",{attrs:{size:"s"}},[a("mjx-mi",{staticClass:"mjx-i"},[a("mjx-c",{attrs:{c:"m"}})],1),a("mjx-mo",{staticClass:"mjx-n"},[a("mjx-c",{attrs:{c:"2217"}})],1),a("mjx-mn",{staticClass:"mjx-n"},[a("mjx-c",{attrs:{c:"2"}})],1)],1)],1),a("mjx-dbox",[a("mjx-dtable",[a("mjx-line"),a("mjx-row",[a("mjx-den",[a("mjx-dstrut"),a("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[a("mjx-c",{attrs:{c:"n"}})],1)],1)],1)],1)],1)],1)],1),a("mjx-mo",{staticClass:"mjx-n",attrs:{space:"3"}},[a("mjx-c",{attrs:{c:"2212"}})],1),a("mjx-mn",{staticClass:"mjx-n",attrs:{space:"3"}},[a("mjx-c",{attrs:{c:"0"}}),a("mjx-c",{attrs:{c:"."}}),a("mjx-c",{attrs:{c:"0"}}),a("mjx-c",{attrs:{c:"1"}})],1),a("mjx-mo",{staticClass:"mjx-n"},[a("mjx-c",{attrs:{c:"]"}})],1)],1)],1)],1),t._v(" "),a("li",[t._v("除了最后一次，任何人金额不会超过人均的两倍（100元10人，不会超过20）")]),t._v(" "),a("li",[t._v("当前面人手气好时，注意保证后面人最少0.01")])])]),t._v(" "),a("li",[t._v("线段分割法\n"),a("ol",[a("li",[t._v("总共 n 人抢红包，直接选 n-1 个点将红包分为 n 份")])])])]),t._v(" "),a("h2",{attrs:{id:"抢红包系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#抢红包系统"}},[t._v("#")]),t._v(" 抢红包系统")]),t._v(" "),a("ol",[a("li",[t._v("系统为每个红包生成唯一id")]),t._v(" "),a("li",[t._v("根据红包id进行hash使得不同红包的所有处理分布在不同的server上，server进行逻辑处理并配备数据库")]),t._v(" "),a("li",[t._v("抢红包只查询数据缓存，不落在数据库")]),t._v(" "),a("li",[t._v("对于过期红包，已完成红包，已领取用户做拦截处理")]),t._v(" "),a("li",[t._v("超过两天后的红包访问量下降，热数据库只存放近几天的数据，其他放入冷数据库")]),t._v(" "),a("li",[t._v("故障处理\n"),a("ol",[a("li",[t._v("下单缓存故障，红包在数据库生成")]),t._v(" "),a("li",[t._v("抢红包缓存故障，降级为数据库查询，同时数据库限流")]),t._v(" "),a("li",[t._v("资金入库多层降级，拆红包后单据实时落地，资金转账多层处理")])])])]),t._v(" "),a("h2",{attrs:{id:"秒杀系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#秒杀系统"}},[t._v("#")]),t._v(" 秒杀系统")]),t._v(" "),a("ol",[a("li",[t._v("业务特点\n"),a("ol",[a("li",[t._v("瞬时流量大")]),t._v(" "),a("li",[t._v("参与用户多，商品数量少")]),t._v(" "),a("li",[t._v("请求读多写少")]),t._v(" "),a("li",[t._v("秒杀状态转换实时性高")])])]),t._v(" "),a("li",[t._v("前端\n"),a("ol",[a("li",[t._v("页面静态化，通过CDN分流")]),t._v(" "),a("li",[t._v("禁止重复提交，用户提交后按钮置灰")]),t._v(" "),a("li",[t._v("用户限流，统一用户某段时间内只能提交一次请求，如通过IP限流")])])]),t._v(" "),a("li",[t._v("后端\n"),a("ol",[a("li",[t._v("业务分离，秒杀业务和其他业务隔离")]),t._v(" "),a("li",[t._v("消息队列缓存请求，服务器根据自身处理能力从队列中获取任务，数据库订阅消息减库存，成功返回秒杀成功，失败返回秒杀结束")]),t._v(" "),a("li",[t._v("可将读写请求分离，redis缓存执行写操作")]),t._v(" "),a("li",[t._v("压力测试")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);